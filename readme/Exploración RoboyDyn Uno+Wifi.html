<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.9.2 (454158)"/><meta name="altitude" content="695.958251953125"/><meta name="author" content="Sergio Majluf"/><meta name="created" content="2017-01-16 02:32:50 +0000"/><meta name="latitude" content="-33.40291709993899"/><meta name="longitude" content="-70.56049012346242"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-01-16 05:32:36 +0000"/><title>Exploraci√≥n RoboyDyn Uno+Wifi</title></head><body>
<div><span style="font-size: 17px;"><b>Paso 0: puente usb CH340.</b></span></div>
<div>Lo primero es tener funcionando el puente usb CH340.</div>
<div>En mi caso, adem√°s descubr√≠ que s√≥lo puedo usar Arduino IDE 1.6.9</div>
<div>Si uso la versi√≥n m√°s reciente, no me funciona nada que no sea Genuino/Arduino de verdad.</div>
<div><br/></div>
<div>Una vez que estamos OK, en la lista de Puertos veremos algo as√≠:</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/E3747A27-D52E-4DA0-9ADE-28C06DE2CE6D.png" height="236" width="594"/></div>
<div><br/></div>
<div>
<div><span style="font-size: 17px;"><b>Primer Paso: ESP</b></span></div>
<div><br/></div>
<div>Para configurar el ESP, hay que instalar una librer√≠a:</div>
<div><a href="https://github.com/esp8266/Arduino">https://github.com/esp8266/Arduino</a></div>
<div><br/></div>
<div>Prob√© varias alternativas, y la √∫nica que me funciona hasta ahora es la del m√≥dulo Gen√©rico. Esto no calza con la descripci√≥n de la placa que dice que tiene 8Mb, mientras que el ESP-01 creo que tiene 1 o 2 a lo sumo. Pero funciona.<img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/A3A05960-3969-46FD-9842-DC7055870593.png" height="816" width="708"/><br/></div>
<div><br/></div>
<div>En el hardware, los¬†DIP Switches:</div>
<div>Upload: 00001110</div>
</div>
<div>Normal: 00001100</div>
<div><br/></div>
<div>En esta tabla est√°n todas las combinaciones ‚Äúv√°lidas‚Äù:</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/switches.png" height="1334" width="750"/></div>
<div>
<div><br/></div>
</div>
<div>El c√≥digo que vamos a subir al ESP es un Servidor Web.</div>
<div>El ESP estar√° esperando nuevos clientes. Cuando llegue un cliente, comparar√° la URL con un patr√≥n conocido, y si el patr√≥n calza, asignar√° un estado a una variable var.</div>
<div><br/></div>
<div>Luego, responder√° al cliente con un contenido html.</div>
<div><br/></div>
<div>El <a href="https://github.com/sergiomajluf/ESP8266-RobotDyn/blob/master/esp-webServer/esp-webServer.ino">c√≥digo completo</a> est√° en Github.</div>
<div><br/></div>
<div>Para subir el c√≥digo, poner los dip switches en modo upload, y presionar ambos botones Reset. Mientras presionas, darle upload al c√≥digo (a la antigua usanza de Arduino), y soltarlos unos segundos despu√©s.</div>
<div><br/></div>
<div>
<div>El upload se demora m√°s que en modo Arduino normal, pero ver√°s el avance en la consola, en letras rojas:</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/CF49D075-12CB-4D99-98F6-F130BA0484E8.png" height="1584" width="2236"/><br/></div>
</div>
<div><br/></div>
<div>Para bootear el ESP en modo normal, debes cambiar el switches #7 a OFF. Esto porque el ESP debe tener el pin CHPD a tierra. Eso hace el switch 7.</div>
<div>
<div><br/></div>
<div>Extra√±amente, al no cambiar de vuelta el switch a veces funciona igual, pero no deber√≠a...</div>
<div><br/></div>
<div>Tras hacer eso, tenemos un ESP conectado a la IP 10.0.1.20 (modificar para que calce con tu RED), que recibe un request web del tipo:</div>
<div><a href="http://10.0.1.20/gpio/0">http://10.0.1.20/gpio/0</a></div>
<div><a href="http://10.0.1.20/gpio/1">http://10.0.1.20/gpio/1</a></div>
<div><br/></div>
</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/63E1AD91-D72C-4A76-9A16-2D242851FADC.png" height="1600" width="2560"/></div>
<div><br/></div>
<div><br/></div>
<div>Ahora debi√©ramos prender un LED desde el ESP, pero eso lo haremos m√°s adelante. Con el output de la consola ya s√© qu√© el software est√° funcionando.</div>
<div>
<div><br/></div>
<div><span style="font-size: 17px;"><b>Segundo Paso: Arduino</b></span></div>
<div>Luego volv√≠ a cambiar los switches:</div>
<div>0011000</div>
<div><br/></div>
</div>
<div>Esto pone la placa en modo ‚ÄúArduino‚Äù normal.</div>
<div>Le puedes subir cualquier sketch. Voy a probar con un blink (desde los ejemplos de Arduino, s√≥lo modificado para que imprima en la consola el estado del LED) que imprime en Serial.</div>
<div><br/></div>
<div>Ahora, como el UART (USB) est√° conectado al arduino y no al ESP, no podemos ver la respuesta serial del ESP, aunque sigue estando ah√≠.</div>
<div>
<div><br/></div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/3D7E5889-D4DA-4D35-9163-5624C34476B6.png" height="1600" width="2560"/><br/></div>
</div>
<div><br/></div>
<div>Nota: este pantallazo lo tom√© antes de modificar el html para darle una mejor UI</div>
<div><br/></div>
<div><span style="font-size: 17px;"><b>Tercer Paso: controlar el LED desde ESP</b></span></div>
<div>
<div>Ahora hay que identificar cu√°l PIN f√≠sico es el que el servidor Web est√° modificando. Por el c√≥digo s√© que es el GPIO #2. En la placa est√°n los pines de Arduino, pero tambi√©n unos pines exclusivos del ESP. Si miras la placa por atr√°s</div>
</div>
<div>¬†vemos en la segunda fila GPIO 02, 12, 02 de nuevo. Tambi√©n se ve el 14 y el 16.</div>
<div><br/></div>
<div>El microcontrolador ESP tiene muchos GPIO, creo que 10 0 m√°s, pero depende en qu√© placa va, a veces se exponen s√≥lo unos pocos, como este caso.</div>
<div><br/></div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/Evernote%20Snapshot%2020170116%20000919.jpg" height="2398" width="1798"/></div>
<div><br/></div>
<div>Volviendo al Web Server, est√° programado para encender y apagar el Pin 2 desde una URL</div>
<div><br/></div>
<div>URL para apagar:</div>
<div>
<div><br/></div>
</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/Evernote%20Snapshot%2020170116%20001153_1.jpg" height="3100" width="2325"/></div>
<div><br/></div>
<div>URL para encender:</div>
<div>Si notaste que cambi√© el cableado, fue el cable a tierra, salt√°ndome la resistencia para que el LED brillara m√°s en la foto no m√°s¬† :)</div>
<div><br/></div>
<div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/Evernote%20Snapshot%2020170116%20001153.jpg" height="3015" width="2391"/><br/></div>
</div>
<div><br/></div>
<div>Ojo que todo este tiempo lo que vemos en la consola serial del Arduino sigue siendo c√≥digo Arduino.</div>
<div><br/></div>
<div>Lo que vamos a hacer es leer un pin digital del arduino, y seg√∫n el estado de ese pin, hacer algo en otro pin del arduino. Por ejemplo, encender un led, o controlar un rel√© <span style="-evernote-sentoj-emoticon:true">üòâ</span></div>
<div><br/></div>
<div>Entonces, a cambiar el c√≥digo Arduino.</div>
<div><br/></div>
<div><span style="font-size: 17px;"><b>Cuarto Paso: un bot√≥n virtual</b></span></div>
<div>Sabemos que el ESP prende y apaga un PIN. Eso a fin de cuentas, es un bot√≥n.</div>
<div>Para probar, creamos c√≥digo Arduino donde un bot√≥n controla el estado de otro pin GPIO</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/7DA985A6-AF98-48C1-86DC-DAEE2A56E870.png" height="1600" width="2560"/></div>
<div><br/></div>
<div>Este c√≥digo de Arduino simplemente lee un pin digital, y si el pin est√° HIGH, enciende el Led 13. Ojo que estamos usando INPUT_PULLUP en el pin que leemos (el pin botonVirtual #2) para simplificar la conexi√≥n el√©ctrica.</div>
<div><br/></div>
<div>Recuerda que para subir c√≥digo al Arduino, ahora los switches deben estar en ese modo:¬†0011000</div>
<div><br/></div>
<div>Con est√© c√≥digo cargado en el Arduino, podemos probar. En este gif vemos que hay DOS LEDs que prenden y apagan simult√°neamente:</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/on-off-led.gif" height="250" width="444"/></div>
<div><br/></div>
<div>El LED amarillo est√° conectado al ESP, y se enciende porque el GPIO02 cambia a HIGH.</div>
<div><br/></div>
<div>El LED azul en cambio, es el LED 13 del Arduino, y se enciende porque el software lo controla. S√≥lo cuando el pin 2 del Arduino est√° HIGH, hacemos que el pin13 lo est√©.</div>
<div><br/></div>
<div>¬øNo es un desprop√≥sito hacer esa vuelta si podr√≠amos controlar todo directamente desde el ESP? S√≠.</div>
<div><br/></div>
<div>La gracia estar√° cuando hagamos que el c√≥digo de Arduino sea m√°s complejo. Por ejemplo que tenga un timer. O que lea una combinaci√≥n de otros pines. O que maneje simult√°neamente varios pines OUTPUT con s√≥lo uno INPUT‚Ä¶ etc.</div>
<div><br/></div>
<div><br/></div>
<div><span style="font-size: 17px;"><b>Quinto Paso: adi√≥s LED, hola rel√©</b></span></div>
<div>Con el c√≥digo OK, eliminamos todas las conexiones, y las reemplazamos por el rel√©. Esta placa requiere al menos 3 conexiones: tierra, 5v, y 1 pin digital por cada uno de los cuatro rev√©s.¬†</div>
<div><br/></div>
<div>En este caso, ese pin digital es el 13. Podr√≠amos usar cualquier otro, pero el c√≥digo Arduino que est√° cargado ya est√° as√≠.</div>
<div><br/></div>
<div>¬°¬°¬°Sube el volumen!!!</div>
<div><a href="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/on-off-rele.mp4">on-off-rele.mp4</a></div>
<div><br/></div>
<div>Finalmente, algo que hicimos antes, pero no hab√≠amos mostrado.</div>
<div>La interfaz desde un m√≥vil, se ve as√≠:</div>
<div><img src="Exploraci%C3%B3n%20RoboyDyn%20Uno+Wifi.resources/2017-01-16%2002.18.18.png" height="1334" width="750"/></div>
<div><br/></div>
</body></html>